os: linux
dist: xenial
language: python
python:
  - '3.8'
cache: pip
install:
  - pip install -r requirements.txt
  - pip install coveralls
script:
  - python manage.py collectstatic --no-input
  - python manage.py makemigrations
  - python manage.py migrate
branches:
  only:
    - postgres
after_success:
  - coverage run manage.py test
  - coveralls
after_failure:
  - echo "Deployment failed"
deploy:
  provider: heroku
  cleanup: true
  api_key: $HEROKU_API_KEY
  app: pollcreator
  on: postgres
